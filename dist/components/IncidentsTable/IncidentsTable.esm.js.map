{"version":3,"file":"IncidentsTable.esm.js","sources":["../../../src/components/IncidentsTable/IncidentsTable.tsx"],"sourcesContent":["import { Table, TableColumn } from '@backstage/core-components';\nimport { useApi } from '@backstage/core-plugin-api';\nimport { Chip, makeStyles, Tooltip } from '@material-ui/core';\nimport Link from '@material-ui/core/Link';\nimport { Alert } from '@material-ui/lab';\nimport React, { useState } from 'react';\nimport { useAsync } from 'react-use';\nimport { IncidentWrapper } from '../Incident';\nimport { ColoredChip } from '../UI/ColoredChip';\nimport { ColoredChips } from '../UI/ColoredChips';\nimport { StatusChip } from '../UI/StatusChip';\n\nimport {\n  RootlyIncident,\n  RootlyIncidentsFetchOpts,\n} from '@rootly/backstage-plugin-common';\nimport { RootlyApiRef } from '../../api';\n\nconst useStyles = makeStyles(theme => ({\n  container: {\n    width: 850,\n  },\n  empty: {\n    padding: theme.spacing(2),\n    display: 'flex',\n    justifyContent: 'center',\n  },\n}));\n\nconst DEFAULT_PAGE_NUMBER = 1;\nconst DEFAULT_PAGE_SIZE = 10;\n\nexport const IncidentsTable = ({ params }: { params?: RootlyIncidentsFetchOpts }) => {\n  const classes = useStyles();\n  const RootlyApi = useApi(RootlyApiRef);\n\n  const smallColumnStyle = {\n    width: '5%',\n    maxWidth: '5%',\n  };\n  const mediumColumnStyle = {\n    width: '10%',\n    maxWidth: '10%',\n  };\n\n  const [page, setPage] = useState({\n    number: DEFAULT_PAGE_NUMBER,\n    size: DEFAULT_PAGE_SIZE,\n  });\n\n  const {\n    value: response,\n    loading,\n    error,\n  } = useAsync(\n    async () => await RootlyApi.getIncidents({ ...params, page: page }),\n    [page],\n  );\n\n  const columns: TableColumn<IncidentWrapper>[] = [\n    {\n      title: 'Started At',\n      field: 'incident.attributes.started_at',\n      type: 'datetime',\n      dateSetting: { locale: 'en-US' },\n      cellStyle: mediumColumnStyle,\n      headerStyle: mediumColumnStyle,\n    },\n    {\n      title: 'Title',\n      field: 'title',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <Tooltip\n          title={\n            rowData.incident.attributes.summary?.substring(0, 255) ||\n            rowData.incident.attributes.title\n          }\n        >\n          <Link\n            target=\"blank\"\n            href={rowData.incident.attributes.url}\n          >\n            {rowData.incident.attributes.title}\n          </Link>\n        </Tooltip>\n      ),\n    },\n    {\n      title: 'Started By',\n      field: 'user.full_name',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <Chip\n          label={rowData.incident.attributes.user?.data.attributes.full_name}\n          size=\"small\"\n        />\n      ),\n    },\n    {\n      title: 'Status',\n      field: 'status',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <StatusChip status={rowData.incident.attributes.status} />\n      ),\n    },\n    {\n      title: 'Severity',\n      field: 'severity',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => (\n        <ColoredChip\n          label={rowData.incident.attributes.severity?.data.attributes.name}\n          tooltip={\n            rowData.incident.attributes.severity?.data.attributes.description\n          }\n          color={rowData.incident.attributes.severity?.data.attributes.color}\n        />\n      ),\n    },\n    {\n      title: 'Environments',\n      field: 'environments',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.environments()} />,\n    },\n    {\n      title: 'Services',\n      field: 'services',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.services()} />,\n    },\n    {\n      title: 'Functionalities',\n      field: 'functionalities',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.functionalities()} />,\n    },\n    {\n      title: 'Teams',\n      field: 'teams',\n      cellStyle: smallColumnStyle,\n      headerStyle: smallColumnStyle,\n      render: rowData => <ColoredChips objects={rowData.groups()} />,\n    },\n  ];\n\n  if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  const data = response\n    ? response.data.map((i: RootlyIncident) => {\n        return new IncidentWrapper(i, response.included);\n      })\n    : [];\n\n  return (\n    <Table\n      isLoading={loading}\n      options={{\n        sorting: true,\n        search: false,\n        paging: true,\n        actionsColumnIndex: -1,\n        pageSize: DEFAULT_PAGE_SIZE,\n        padding: 'dense',\n      }}\n      localization={{ header: { actions: undefined } }}\n      columns={columns}\n      data={data}\n      page={page.number - 1}\n      totalCount={response?.meta.total_count}\n      emptyContent={<div className={classes.empty}>No incidents</div>}\n      onPageChange={pageIndex => setPage({ ...page, number: pageIndex + 1 })}\n      onRowsPerPageChange={rowsPerPage =>\n        setPage({ ...page, size: rowsPerPage })\n      }\n    />\n  );\n};\n"],"names":[],"mappings":";;;;;;;;;;;;;AAkBA,MAAM,SAAA,GAAY,WAAW,CAAU,KAAA,MAAA;AAAA,EACrC,SAAW,EAAA;AAAA,IACT,KAAO,EAAA,GAAA;AAAA,GACT;AAAA,EACA,KAAO,EAAA;AAAA,IACL,OAAA,EAAS,KAAM,CAAA,OAAA,CAAQ,CAAC,CAAA;AAAA,IACxB,OAAS,EAAA,MAAA;AAAA,IACT,cAAgB,EAAA,QAAA;AAAA,GAClB;AACF,CAAE,CAAA,CAAA,CAAA;AAEF,MAAM,mBAAsB,GAAA,CAAA,CAAA;AAC5B,MAAM,iBAAoB,GAAA,EAAA,CAAA;AAEnB,MAAM,cAAiB,GAAA,CAAC,EAAE,MAAA,EAAoD,KAAA;AACnF,EAAA,MAAM,UAAU,SAAU,EAAA,CAAA;AAC1B,EAAM,MAAA,SAAA,GAAY,OAAO,YAAY,CAAA,CAAA;AAErC,EAAA,MAAM,gBAAmB,GAAA;AAAA,IACvB,KAAO,EAAA,IAAA;AAAA,IACP,QAAU,EAAA,IAAA;AAAA,GACZ,CAAA;AACA,EAAA,MAAM,iBAAoB,GAAA;AAAA,IACxB,KAAO,EAAA,KAAA;AAAA,IACP,QAAU,EAAA,KAAA;AAAA,GACZ,CAAA;AAEA,EAAA,MAAM,CAAC,IAAA,EAAM,OAAO,CAAA,GAAI,QAAS,CAAA;AAAA,IAC/B,MAAQ,EAAA,mBAAA;AAAA,IACR,IAAM,EAAA,iBAAA;AAAA,GACP,CAAA,CAAA;AAED,EAAM,MAAA;AAAA,IACJ,KAAO,EAAA,QAAA;AAAA,IACP,OAAA;AAAA,IACA,KAAA;AAAA,GACE,GAAA,QAAA;AAAA,IACF,YAAY,MAAM,SAAU,CAAA,YAAA,CAAa,EAAE,GAAG,MAAA,EAAQ,MAAY,CAAA;AAAA,IAClE,CAAC,IAAI,CAAA;AAAA,GACP,CAAA;AAEA,EAAA,MAAM,OAA0C,GAAA;AAAA,IAC9C;AAAA,MACE,KAAO,EAAA,YAAA;AAAA,MACP,KAAO,EAAA,gCAAA;AAAA,MACP,IAAM,EAAA,UAAA;AAAA,MACN,WAAA,EAAa,EAAE,MAAA,EAAQ,OAAQ,EAAA;AAAA,MAC/B,SAAW,EAAA,iBAAA;AAAA,MACX,WAAa,EAAA,iBAAA;AAAA,KACf;AAAA,IACA;AAAA,MACE,KAAO,EAAA,OAAA;AAAA,MACP,KAAO,EAAA,OAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CACN,OAAA,qBAAA,KAAA,CAAA,aAAA;AAAA,QAAC,OAAA;AAAA,QAAA;AAAA,UACC,KAAA,EACE,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,OAAA,EAAS,SAAU,CAAA,CAAA,EAAG,GAAG,CAAA,IACrD,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,KAAA;AAAA,SAAA;AAAA,wBAG9B,KAAA,CAAA,aAAA;AAAA,UAAC,IAAA;AAAA,UAAA;AAAA,YACC,MAAO,EAAA,OAAA;AAAA,YACP,IAAA,EAAM,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,GAAA;AAAA,WAAA;AAAA,UAEjC,OAAA,CAAQ,SAAS,UAAW,CAAA,KAAA;AAAA,SAC/B;AAAA,OACF;AAAA,KAEJ;AAAA,IACA;AAAA,MACE,KAAO,EAAA,YAAA;AAAA,MACP,KAAO,EAAA,gBAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CACN,OAAA,qBAAA,KAAA,CAAA,aAAA;AAAA,QAAC,IAAA;AAAA,QAAA;AAAA,UACC,OAAO,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,IAAA,EAAM,KAAK,UAAW,CAAA,SAAA;AAAA,UACzD,IAAK,EAAA,OAAA;AAAA,SAAA;AAAA,OACP;AAAA,KAEJ;AAAA,IACA;AAAA,MACE,KAAO,EAAA,QAAA;AAAA,MACP,KAAO,EAAA,QAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,MAAA,EAAQ,6BACL,KAAA,CAAA,aAAA,CAAA,UAAA,EAAA,EAAW,QAAQ,OAAQ,CAAA,QAAA,CAAS,WAAW,MAAQ,EAAA,CAAA;AAAA,KAE5D;AAAA,IACA;AAAA,MACE,KAAO,EAAA,UAAA;AAAA,MACP,KAAO,EAAA,UAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CACN,OAAA,qBAAA,KAAA,CAAA,aAAA;AAAA,QAAC,WAAA;AAAA,QAAA;AAAA,UACC,OAAO,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,QAAA,EAAU,KAAK,UAAW,CAAA,IAAA;AAAA,UAC7D,SACE,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,QAAA,EAAU,KAAK,UAAW,CAAA,WAAA;AAAA,UAExD,OAAO,OAAQ,CAAA,QAAA,CAAS,UAAW,CAAA,QAAA,EAAU,KAAK,UAAW,CAAA,KAAA;AAAA,SAAA;AAAA,OAC/D;AAAA,KAEJ;AAAA,IACA;AAAA,MACE,KAAO,EAAA,cAAA;AAAA,MACP,KAAO,EAAA,cAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CAAW,OAAA,qBAAA,KAAA,CAAA,aAAA,CAAC,gBAAa,OAAS,EAAA,OAAA,CAAQ,cAAgB,EAAA,CAAA;AAAA,KACpE;AAAA,IACA;AAAA,MACE,KAAO,EAAA,UAAA;AAAA,MACP,KAAO,EAAA,UAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CAAW,OAAA,qBAAA,KAAA,CAAA,aAAA,CAAC,gBAAa,OAAS,EAAA,OAAA,CAAQ,UAAY,EAAA,CAAA;AAAA,KAChE;AAAA,IACA;AAAA,MACE,KAAO,EAAA,iBAAA;AAAA,MACP,KAAO,EAAA,iBAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CAAW,OAAA,qBAAA,KAAA,CAAA,aAAA,CAAC,gBAAa,OAAS,EAAA,OAAA,CAAQ,iBAAmB,EAAA,CAAA;AAAA,KACvE;AAAA,IACA;AAAA,MACE,KAAO,EAAA,OAAA;AAAA,MACP,KAAO,EAAA,OAAA;AAAA,MACP,SAAW,EAAA,gBAAA;AAAA,MACX,WAAa,EAAA,gBAAA;AAAA,MACb,QAAQ,CAAW,OAAA,qBAAA,KAAA,CAAA,aAAA,CAAC,gBAAa,OAAS,EAAA,OAAA,CAAQ,QAAU,EAAA,CAAA;AAAA,KAC9D;AAAA,GACF,CAAA;AAEA,EAAA,IAAI,KAAO,EAAA;AACT,IAAA,uBAAQ,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA,EAAM,QAAS,EAAA,OAAA,EAAA,EAAS,MAAM,OAAQ,CAAA,CAAA;AAAA,GAChD;AAEA,EAAA,MAAM,OAAO,QACT,GAAA,QAAA,CAAS,IAAK,CAAA,GAAA,CAAI,CAAC,CAAsB,KAAA;AACvC,IAAA,OAAO,IAAI,eAAA,CAAgB,CAAG,EAAA,QAAA,CAAS,QAAQ,CAAA,CAAA;AAAA,GAChD,IACD,EAAC,CAAA;AAEL,EACE,uBAAA,KAAA,CAAA,aAAA;AAAA,IAAC,KAAA;AAAA,IAAA;AAAA,MACC,SAAW,EAAA,OAAA;AAAA,MACX,OAAS,EAAA;AAAA,QACP,OAAS,EAAA,IAAA;AAAA,QACT,MAAQ,EAAA,KAAA;AAAA,QACR,MAAQ,EAAA,IAAA;AAAA,QACR,kBAAoB,EAAA,CAAA,CAAA;AAAA,QACpB,QAAU,EAAA,iBAAA;AAAA,QACV,OAAS,EAAA,OAAA;AAAA,OACX;AAAA,MACA,cAAc,EAAE,MAAA,EAAQ,EAAE,OAAA,EAAS,QAAY,EAAA;AAAA,MAC/C,OAAA;AAAA,MACA,IAAA;AAAA,MACA,IAAA,EAAM,KAAK,MAAS,GAAA,CAAA;AAAA,MACpB,UAAA,EAAY,UAAU,IAAK,CAAA,WAAA;AAAA,MAC3B,8BAAe,KAAA,CAAA,aAAA,CAAA,KAAA,EAAA,EAAI,SAAW,EAAA,OAAA,CAAQ,SAAO,cAAY,CAAA;AAAA,MACzD,YAAA,EAAc,eAAa,OAAQ,CAAA,EAAE,GAAG,IAAM,EAAA,MAAA,EAAQ,SAAY,GAAA,CAAA,EAAG,CAAA;AAAA,MACrE,mBAAA,EAAqB,iBACnB,OAAQ,CAAA,EAAE,GAAG,IAAM,EAAA,IAAA,EAAM,aAAa,CAAA;AAAA,KAAA;AAAA,GAE1C,CAAA;AAEJ;;;;"}