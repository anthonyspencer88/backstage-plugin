{"version":3,"file":"index-ee5e307b.esm.js","sources":["../../src/components/RootlyIncidentsPage/RootlyIncidentsPageLayout.tsx","../../src/components/RootlyIncidentsPage/DefaultRootlyIncidentsPage.tsx","../../src/components/RootlyIncidentsPage/RootlyIncidentsPage.tsx"],"sourcesContent":["import { stringifyEntityRef } from '@backstage/catalog-model';\nimport {\n  Content,\n  ContentHeader,\n  Page,\n  Progress\n} from '@backstage/core-components';\nimport { attachComponentData, useApi } from '@backstage/core-plugin-api';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { Box, Button, Grid, TabProps } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport { default as React, useState } from 'react';\nimport { useAsync } from 'react-use';\nimport { RootlyApiRef } from '../../api';\nimport { Entity, Service } from '../../types';\nimport { IncidentsTable } from '../IncidentsTable';\nimport { ServicesDialog } from '../ServicesDialog';\n\ntype SubRoute = {\n  path: string;\n  title: string;\n  children: JSX.Element;\n  tabProps?: TabProps<React.ElementType, { component?: React.ElementType }>;\n};\n\nconst Route: (props: SubRoute) => null = () => null;\n\n// This causes all mount points that are discovered within this route to use the path of the route itself\nattachComponentData(Route, 'core.gatherMountPoints', true);\n\nexport const RootlyIncidentsPageLayout = () => {\n  const { entity } = useEntity();\n  const RootlyApi = useApi(RootlyApiRef);\n\n  const [open, setOpen] = useState(false);\n  const [reload, setReload] = useState(false);\n\n  const handleOpenDialog = () => {\n    setOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setOpen(false);\n  };\n\n  const handleCloseImport = async (entity: Entity) => {\n    await RootlyApi.importEntity(entity);\n    setReload(!reload);\n  };\n\n  const handleCloseUpdate = async (\n    entity: Entity,\n    old_service: Service,\n    service: Service,\n  ) => {\n    await RootlyApi.updateEntity(entity, old_service, service);\n    setReload(!reload);\n  };\n\n  const entityTriplet = stringifyEntityRef({\n    namespace: entity.metadata.namespace,\n    kind: entity.kind,\n    name: entity.metadata.name,\n  });\n\n  const {\n    value: response,\n    loading,\n    error,\n  } = useAsync(\n    async () =>\n      await RootlyApi.getServices({\n        filter: {\n          backstage_id: entityTriplet,\n        },\n      }),\n    [reload],\n  );\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  const service =\n    response && response.data && response.data.length > 0\n      ? response.data[0]\n      : null;\n\n  if (!service) {\n    return (\n      <Page themeId=\"tool\">\n        <Content>\n          <ContentHeader title={entity.metadata.name} />\n          <Grid container spacing={3} direction=\"column\">\n            <Box sx={{ mx: 'auto' }} mt={2}>\n              <Alert severity=\"error\">\n                Looks like this component is not linked to any services in\n                Rootly\n              </Alert>\n            </Box>\n            <Box sx={{ mx: 'auto' }} mt={2}>\n              <Button\n                color=\"primary\"\n                variant=\"contained\"\n                onClick={handleOpenDialog}\n              >\n                Import or link to an existing Rootly service\n              </Button>\n            </Box>\n            <ServicesDialog\n              open={open}\n              entity={entity as Entity}\n              handleClose={handleCloseDialog}\n              handleImport={handleCloseImport}\n              handleUpdate={handleCloseUpdate}\n            />\n          </Grid>\n        </Content>\n      </Page>\n    );\n  } else {\n    return (\n      <Page themeId=\"tool\">\n        <Content>\n        <ContentHeader title=\"Ongoing incidents\" />\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <IncidentsTable\n                params={{\n                  filter: {\n                    services: service.attributes.slug,\n                    status: \"started,mitigated\"\n                  },\n                  include:\n                    'environments,services,functionalities,groups,incident_types',\n                }}\n              />\n            </Grid>\n          </Grid>\n          <ContentHeader title=\"Past incidents\" />\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <IncidentsTable\n                params={{\n                  filter: {\n                    services: service.attributes.slug,\n                  },\n                  include:\n                    'environments,services,functionalities,groups,incident_types',\n                }}\n              />\n            </Grid>\n          </Grid>\n        </Content>\n      </Page>\n    );\n  }\n};\n\nRootlyIncidentsPageLayout.Route = Route;\n","import React from 'react';\nimport { RootlyIncidentsPageLayout } from './RootlyIncidentsPageLayout';\n\nexport const DefaultRootlyIncidentsPage = () => {\n  return <RootlyIncidentsPageLayout />;\n};\n","import React from 'react';\nimport { useOutlet } from 'react-router';\nimport { DefaultRootlyIncidentsPage } from './DefaultRootlyIncidentsPage';\n\nexport const RootlyIncidentsPage = () => {\n  const outlet = useOutlet();\n\n  return outlet || <DefaultRootlyIncidentsPage />;\n};\n"],"names":["entity","service"],"mappings":"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"}