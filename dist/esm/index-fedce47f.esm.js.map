{"version":3,"file":"index-fedce47f.esm.js","sources":["../../src/components/RootlyIncidentsPage/RootlyIncidentsPageLayout.tsx","../../src/components/RootlyIncidentsPage/DefaultRootlyIncidentsPage.tsx","../../src/components/RootlyIncidentsPage/RootlyIncidentsPage.tsx"],"sourcesContent":["import { stringifyEntityRef } from '@backstage/catalog-model';\nimport {\n  Content,\n  ContentHeader,\n  Page,\n  Progress\n} from '@backstage/core-components';\nimport { attachComponentData, useApi } from '@backstage/core-plugin-api';\nimport { useEntity } from '@backstage/plugin-catalog-react';\nimport { Box, Button, Grid, TabProps } from '@material-ui/core';\nimport { Alert } from '@material-ui/lab';\nimport { default as React, useState } from 'react';\nimport { useAsync } from 'react-use';\nimport { RootlyApiRef } from '../../api';\nimport { Entity, Service } from '../../types';\nimport { IncidentsTable } from '../IncidentsTable';\nimport { ServicesDialog } from '../ServicesDialog';\n\ntype SubRoute = {\n  path: string;\n  title: string;\n  children: JSX.Element;\n  tabProps?: TabProps<React.ElementType, { component?: React.ElementType }>;\n};\n\nconst Route: (props: SubRoute) => null = () => null;\n\n// This causes all mount points that are discovered within this route to use the path of the route itself\nattachComponentData(Route, 'core.gatherMountPoints', true);\n\nexport const RootlyIncidentsPageLayout = () => {\n  const { entity } = useEntity();\n  const RootlyApi = useApi(RootlyApiRef);\n\n  const [open, setOpen] = useState(false);\n  const [reload, setReload] = useState(false);\n\n  const handleOpenDialog = () => {\n    setOpen(true);\n  };\n\n  const handleCloseDialog = () => {\n    setOpen(false);\n  };\n\n  const handleCloseImport = async (entity: Entity) => {\n    await RootlyApi.importEntity(entity);\n    setReload(!reload);\n  };\n\n  const handleCloseUpdate = async (\n    entity: Entity,\n    old_service: Service,\n    service: Service,\n  ) => {\n    await RootlyApi.updateEntity(entity, old_service, service);\n    setReload(!reload);\n  };\n\n  const entityTriplet = stringifyEntityRef({\n    namespace: entity.metadata.namespace,\n    kind: entity.kind,\n    name: entity.metadata.name,\n  });\n\n  const {\n    value: response,\n    loading,\n    error,\n  } = useAsync(\n    async () =>\n      await RootlyApi.getServices({\n        filter: {\n          backstage_id: entityTriplet,\n        },\n      }),\n    [reload],\n  );\n\n  if (loading) {\n    return <Progress />;\n  } else if (error) {\n    return <Alert severity=\"error\">{error.message}</Alert>;\n  }\n\n  const service =\n    response && response.data && response.data.length > 0\n      ? response.data[0]\n      : null;\n\n  if (!service) {\n    return (\n      <Page themeId=\"tool\">\n        <Content>\n          <ContentHeader title={entity.metadata.name} />\n          <Grid container spacing={3} direction=\"column\">\n            <Box sx={{ mx: 'auto' }} mt={2}>\n              <Alert severity=\"error\">\n                Looks like this component is not linked to any services in\n                Rootly\n              </Alert>\n            </Box>\n            <Box sx={{ mx: 'auto' }} mt={2}>\n              <Button\n                color=\"primary\"\n                variant=\"contained\"\n                onClick={handleOpenDialog}\n              >\n                Import or link to an existing Rootly service\n              </Button>\n            </Box>\n            <ServicesDialog\n              open={open}\n              entity={entity as Entity}\n              handleClose={handleCloseDialog}\n              handleImport={handleCloseImport}\n              handleUpdate={handleCloseUpdate}\n            />\n          </Grid>\n        </Content>\n      </Page>\n    );\n  } else {\n    return (\n      <Page themeId=\"tool\">\n        <Content>\n        <ContentHeader title=\"Ongoing incidents\" />\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <IncidentsTable\n                params={{\n                  filter: {\n                    services: service.attributes.slug,\n                    status: \"started,mitigated\"\n                  },\n                  include:\n                    'environments,services,functionalities,groups,incident_types',\n                }}\n              />\n            </Grid>\n          </Grid>\n          <ContentHeader title=\"Past incidents\" />\n          <Grid container spacing={3} direction=\"column\">\n            <Grid item>\n              <IncidentsTable\n                params={{\n                  filter: {\n                    services: service.attributes.slug,\n                  },\n                  include:\n                    'environments,services,functionalities,groups,incident_types',\n                }}\n              />\n            </Grid>\n          </Grid>\n        </Content>\n      </Page>\n    );\n  }\n};\n\nRootlyIncidentsPageLayout.Route = Route;\n","import React from 'react';\nimport { RootlyIncidentsPageLayout } from './RootlyIncidentsPageLayout';\n\nexport const DefaultRootlyIncidentsPage = () => {\n  return <RootlyIncidentsPageLayout />;\n};\n","import React from 'react';\nimport { useOutlet } from 'react-router';\nimport { DefaultRootlyIncidentsPage } from './DefaultRootlyIncidentsPage';\n\nexport const RootlyIncidentsPage = () => {\n  const outlet = useOutlet();\n\n  return outlet || <DefaultRootlyIncidentsPage />;\n};\n"],"names":[],"mappings":"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"}