{"version":3,"file":"api.esm.js","sources":["../src/api.ts"],"sourcesContent":["import {\n    createApiRef,\n    ConfigApi,\n    DiscoveryApi,\n  } from '@backstage/core-plugin-api';\nimport { RootlyApi } from 'rootly-backstage-plugin-common';\n\nexport const RootlyApiRef = createApiRef<RootlyApi>({\n    id: 'plugin.rootly.service',\n  });\n\nexport const useRootlyClient = ({ discovery, config, organizationId }: { discovery: DiscoveryApi, config: ConfigApi, organizationId?: string }) => {\n  const configKeys = config.getConfig('rootly').keys();\n\n  let token = config.getOptionalString(`rootly.${configKeys.at(0)}.apiKey`);\n\n  if (organizationId) {\n    token = config.getOptionalString(`rootly.${organizationId}.apiKey`)\n  } else if (configKeys.length > 1) {\n    let defaultOrgId = config.getConfig('rootly').keys().at(0)\n    for (const orgId of config.getConfig('rootly').keys()) {\n      if (config.getOptionalBoolean(`rootly.${orgId}.isDefault`)) {\n        defaultOrgId = orgId\n        break;\n      }\n    }\n    token = config.getOptionalString(`rootly.${defaultOrgId}.apiKey`)\n  }\n\n  const client = new RootlyApi({\n    apiProxyPath: discovery.getBaseUrl('proxy'),\n    apiToken: new Promise((resolve) => { resolve({token: token}) }),\n  });\n  return client;\n}"],"names":[],"mappings":";;;AAOO,MAAM,eAAe,YAAwB,CAAA;AAAA,EAChD,EAAI,EAAA,uBAAA;AACN,CAAC,EAAA;AAEI,MAAM,kBAAkB,CAAC,EAAE,SAAW,EAAA,MAAA,EAAQ,gBAA8F,KAAA;AACjJ,EAAA,MAAM,UAAa,GAAA,MAAA,CAAO,SAAU,CAAA,QAAQ,EAAE,IAAK,EAAA,CAAA;AAEnD,EAAI,IAAA,KAAA,GAAQ,OAAO,iBAAkB,CAAA,CAAA,OAAA,EAAU,WAAW,EAAG,CAAA,CAAC,CAAC,CAAS,OAAA,CAAA,CAAA,CAAA;AAExE,EAAA,IAAI,cAAgB,EAAA;AAClB,IAAA,KAAA,GAAQ,MAAO,CAAA,iBAAA,CAAkB,CAAU,OAAA,EAAA,cAAc,CAAS,OAAA,CAAA,CAAA,CAAA;AAAA,GACpE,MAAA,IAAW,UAAW,CAAA,MAAA,GAAS,CAAG,EAAA;AAChC,IAAI,IAAA,YAAA,GAAe,OAAO,SAAU,CAAA,QAAQ,EAAE,IAAK,EAAA,CAAE,GAAG,CAAC,CAAA,CAAA;AACzD,IAAA,KAAA,MAAW,SAAS,MAAO,CAAA,SAAA,CAAU,QAAQ,CAAA,CAAE,MAAQ,EAAA;AACrD,MAAA,IAAI,MAAO,CAAA,kBAAA,CAAmB,CAAU,OAAA,EAAA,KAAK,YAAY,CAAG,EAAA;AAC1D,QAAe,YAAA,GAAA,KAAA,CAAA;AACf,QAAA,MAAA;AAAA,OACF;AAAA,KACF;AACA,IAAA,KAAA,GAAQ,MAAO,CAAA,iBAAA,CAAkB,CAAU,OAAA,EAAA,YAAY,CAAS,OAAA,CAAA,CAAA,CAAA;AAAA,GAClE;AAEA,EAAM,MAAA,MAAA,GAAS,IAAI,SAAU,CAAA;AAAA,IAC3B,YAAA,EAAc,SAAU,CAAA,UAAA,CAAW,OAAO,CAAA;AAAA,IAC1C,QAAU,EAAA,IAAI,OAAQ,CAAA,CAAC,OAAY,KAAA;AAAE,MAAQ,OAAA,CAAA,EAAC,OAAa,CAAA,CAAA;AAAA,KAAG,CAAA;AAAA,GAC/D,CAAA,CAAA;AACD,EAAO,OAAA,MAAA,CAAA;AACT;;;;"}